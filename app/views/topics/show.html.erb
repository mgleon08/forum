<h1><%=@topic.name%>  <span class="fb-like"></span></h1>
<p><%=@topic.article%></p>
<%if @topic.picture.try(:upload) != nil%>
<div><%=image_tag(@topic.picture.upload.url(:medium), alt: "article_p")%></div>
<br>
<%end%>

<%=link_to "回首頁", root_path(:page=>params[:page]), :class => "btn btn-primary"%>

<%=link_to "加入收藏", collect_topic_path(@topic,:page=>params[:page]), :class => "btn btn-warning"%>

<br/>
<br/>
<table class="table table-striped">
<tr>
  <td>頭像</td>
  <td>發布人</td>
  <td>留言內容</td>
  <td>上傳圖片</td>
  <td>發布時間</td>
  <%if current_user != nil %>
  <td>編輯</td>
  <td>刪除</td>
  <%end%>
</tr>


<%@topic.comments.each do |t|%>
  <tr>
    <td><%=image_tag(Gravatar.new(t.user.email).image_url,:size => "35x35")%>
    </td>
    <td><%=t.user.try(:user_name)%></td>
    <td><%=t.user_comment%></td>
    <td>
      <% if t.picture %>
      <div><%=image_tag(t.picture.upload.url(:thumb), alt: "comment_p")%></div>
      <br>
      <%end%>
    </td>
    <td><%=t.created_at%></td>
    <%if current_user %>
      <td>
        <%if current_user == t.user || current_user.admin?%>
          <%=link_to "編輯", edit_topic_comment_path(@topic,t), :class => "btn btn-info" %>
        <%end%>
      </td>
      <td>
      <%if current_user == t.user || current_user.role == "admin" %>
        <%=link_to "刪除", topic_comment_path(@topic,t), :method => :delete, :class => "btn btn-danger" %>
      <%end%>
      </td>
    <%end%>
  </tr>
<%end%>
</table>

<%if current_user != nil %>
  <%=form_for setup_comment(@comment), :url => topic_comments_path(@topic) do |t|%>
    <h2><%= t.label :user_comment, "留言:"%></h2>
    <%= t.text_area :user_comment, :class => "form-control"%>
    <br/>

    <%= t.fields_for :picture do |picture_form| %>
    <p>
    <%= picture_form.label :upload, "上傳檔案" %>
    <%= picture_form.file_field :upload %>

    <% unless picture_form.object.new_record? %>
        <%= picture_form.label :_destroy, 'Remove:' %>
        <%= picture_form.check_box :_destroy %>
    <% end %>
    </p>
    <% end %>

    <%= t.submit "送出", :class => "btn btn-success"%>
  <%end%>
<%else%>
  <%= link_to('留言請先登入', new_session_path(:user)) %>
<%end%>
